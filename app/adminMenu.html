<html>
  <head>
    <title>Scout 15: Admin menu</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="lib/css/bootstrap.min.css" />
    <link rel="stylesheet" href="lib/css/main.css" />
 
    <!--TODO: Investigate how this works.  Shouldn't these be classes
      instead of ids-->
    <!--TODO: These belong in a file, not here -->
    <!--TODO: On the iPhone 6 these scroll laterally -->
    <style>
#side {
  float:left;
  width: 33%;
}
#center {
  float:left;
  width: 34%;
}
button {
  float:left;
  width: 95%;
  height: 65px;
}
    </style>
    <script>
var xmlHttpObj;

function catchEvent(eventObj, event, eventHandler) {
  if (eventObj.addEventListener) {
    eventObj.addEventListener(event, eventHandler,false);
  } else if (eventObj.attachEvent) {
    event = "on" + event;
    eventObj.attachEvent(event, eventHandler);
  }
}

catchEvent(window,"load", function() {
  getCurrentGame();
});

function getXmlHttp() {
  var xmlhttp = null;
  if (window.XMLHttpRequest) {
     xmlhttp = new XMLHttpRequest();
  } else {
    try {
      xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");

    } catch (e) {
      try {
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
      } catch (e) {
        return null;
      }
    }
  }
  return xmlhttp;
}

function getCurrentGame() {
   // if xmlHttpObj not set
   if (!xmlHttpObj)
      xmlHttpObj = getXmlHttp();
   if (!xmlHttpObj) return;

   xmlHttpObj.open('GET', "getMatch.php", true);
   xmlHttpObj.onreadystatechange = processCurrentMatch;
   xmlHttpObj.send(null);
}
function processCurrentMatch() {

  if(xmlHttpObj.readyState == 4 && xmlHttpObj.status == 200) {
    try {

      // evaluate JSON
      eval("var match = ("+ xmlHttpObj.responseText+")");
      document.getElementById('cur_match_nr').value = match.number_;
      document.getElementById('cur_event_cd').value = match.event_code;
      document.getElementById('cur_match_type').value = match.match_type;
    } catch (e) {
      alert(e.message);
    }
  } else if (xmlHttpObj.readyState == 4 && xmlHttpObj.status != 200) {
    document.getElementById('info').innerHTML = 'Error: No current match!';
  }
}

function cur_next() {
  var current_match = Number(document.getElementById("cur_match_nr").value);
  current_match += 1;
  document.getElementById("cur_match_nr").value = current_match;
}

function cur_prev() {
  var current_match = Number(document.getElementById("cur_match_nr").value);
  current_match -= 1;
  document.getElementById("cur_match_nr").value = current_match;
}

function buildParams() {
  var params = "event_code=" + document.getElementById("event_code").value;
  params += "&match_type=" + document.getElementById("match_type").value;
  return params;
}

function loadMatches() {
  params = buildParams()
  request = new ajaxRequest()
  request.open("POST", "loadMatches.php", true)
  request.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
//  request.setRequestHeader("Content-length", params.length)
//  request.setRequestHeader("Connection", "close")

  request.onreadystatechange = function() {
    if (this.readyState == 4) {
      if (this.status == 200) {
        if (this.responseText != null) {
          document.getElementById('info').innerHTML = this.responseText
        } else
          alert("Ajax error: No data received")
      } else
        alert("Ajax error: " + this.statusText)
    }
  }

  request.send(params)
}

function ajaxRequest() {
  try {
    var request = new XMLHttpRequest()
  } catch (e1) {
    try {
      request = new ActiveXObject("Msxml2.XMLHTTP")
    } catch (e2) {
      try {
        request = new ActiveXObject("Microsoft.XMLHTTP")
      } catch (e3) {
        request = false
      }
    }
  }
  return request
}
    </script>
  </head>

  <body>
    <div id="container">
      <!-- Nav tabs -->
      <ul class="nav nav-tabs" id="adminTab">
        <li class="active">
          <a href="#setcurrent" data-toggle="tab">Set Current</a>
        </li>
        <li>
          <a href="#loadmatch" data-toggle="tab">Load Matches</a>
        </li>
      </ul>

      <!-- Tab panes -->
      <div class="tab-content">
        <div class="tab-pane active" id="setcurrent">
           <div id="side">
             <input id="cur_event_cd" type="text" class="form-control" placeholder="Event code">
            <p>
	      The code for NYC is NYNY<br>
              I've been testing with WAAMV<br>
            </p>
           </div> <!--left column setcurrent tab-pane -->
           <div id="center">
             <input id="cur_match_type" type="text" class="form-control" placeholder="Match type">
             <p>
               Types of matches: qualifications, practice
             </p>
           </div> <!--center column setcurrent tab-pane -->
           <div id="side">
             <!--TODO: the min and the max should be set from an event object-->
             <input id="cur_match_nr" type="number" class="form-control" min="1" max="65" placeholder="Match #">
             <button type="button" id="cur_next" class="btn btn-default btn-lg btn-block" onclick="cur_next()">
               Next
             </button>
             <button type="button" id="cur_prev" class="btn btn-default btn-lg btn-block" onclick="cur_prev()">
               Previous
             </button>
             <button type="button" id="cur_save" class="btn btn-danger btn-lg btn-block" onclick="saveCurrent()">
               Save
             </button>
           </div> <!--left column setcurrent tab-pane -->
        </div> <!--setcurrent tab-pane setcurrent tab-pane -->
        <div class="tab-pane" id="loadmatch">
          <div id="side">
            <input id="event_code" type="text" class="form-control" placeholder="Event Code">
            <p>
	      The code for NYC is NYNY<br>
              I've been testing with WAAMV<br>
            </p>
          </div> <!--left column loadmatch tab-pane-->
        <div id="center">
          <input id="match_type" type="text" class="form-control" placeholder="Match Type">
          <p>
            Types of matches: qualifications, practice
          </p>
        </div> <!--center column loadmatch tab-pane-->
        <div id="side">
          <button type="button" id="loadmatch_btn" class="btn btn-default btn-lg btn-block" onclick="loadMatches()">
            Load Matches
          </button>
        </div> <!--right column loadmatch tab-pane-->
      </div> <!--tab-content--> 
      <div>
        <div id="info" class="panel panel-default"></div>
      </div> <!--info panel at bottom-->
    </div> <!--container-->

    <script src="lib/js/jquery-1.10.1.js"></script>
    <script src="lib/js/bootstrap.min.js"></script>
    <script src="lib/js/adminMenu/saveCurrent.js"></script>
  </body>
</html>
